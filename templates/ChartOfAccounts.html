<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart of Accounts- FinKen</title>
    <link rel="stylesheet" href="/frontend/styles.css">
</head>
<body>
    <!-- Header with Branding -->
    <div class="header">
        <div class="branding">
            <div class="branding-content">
                <img src="/frontend/images/finkenlogo.png" alt="FinKen Logo" class="logo-image">
                <div class="branding-text">
                    <h1><span class="pocket-text">Pocket</span><span class="watch-text">Watch</span></h1>
                    <p>Financial Accounting App</p>
                </div>
            </div>
        </div>

        <!-- User Header -->
        <div class="user-header">
            <div class="user-info">
                <span class="user-name">{{ user_name }}</span>
                <span class="user-role-badge">{{ user_role.title() }}</span>
            </div>
            <div class="user-profile">
                <img src="{{ url_for('profile_image', filename=user_profile_picture) }}"
                     alt="Profile Picture" class="profile-image">
            </div>
        </div>
    </div>

    <!-- Navigation Menu -->
    <button class="nav-toggle">Toggle Navigation</button>
    <nav class="navbar">
        <ul class="nav-list">
            <img src="/frontend/images/finkenlogo.png" alt="FinKen Logo" class="logo-image">
            <li><a href="/Home">Home</a></li>
            {% if user_role == 'administrator' %}
            <!-- Administrator-only options -->
                <li><a href="/ManageRegistrations">Manage Registrations</a></li>
                <li><a href="/Users">Users</a></li>
                <li><a href="/ExpiringPasswords">Expiring Passwords</a></li>
            {% endif %}
            <!-- Common options for all users -->
            <li class="active"><a href="/ChartOfAccounts"> Chart of Accounts</a></li>
            <li><a href="#">Statements</a></li>
            <li><a href="/SignOut">Sign Out</a></li>
        </ul>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <div class="admin-container">
        <h1 class="admin-header">Chart of Accounts</h1>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <label for="status-filter">Filter by Account Type:</label>
            <select id="status-filter">
                <option value="">All Types</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="asset">Asset</option>
                <option value="liability">Liability</option>
                <option value="expense">Expense</option>
            </select>
            <input type="text" id="search-input" placeholder="Search by name or account number...">
            <button id="search-btn" class="search-btn">Search</button>
            {% if user_role == 'administrator' %}
            <button class="btn btn-primary" id="new-account-btn">Add New Account</button>
            {% endif %}
        </div>

    <!-- Chart of Accounts -->
        <div class="requests-table">
            <table id="accountsTable">
                <thead>
                    <tr>
                        <th class="col-number">Number</th>
                        <th class="col-name">Name</th>
                        <th class="col-type">Type</th>
                        <th class="col-term">NormalSide</th>
                        <th class="col-balance">Balance</th>
                        <th class="col-createdby">Created By</th>
                        <th class="col-date">Date Created</th>
                        <th class="col-comments">Comments</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="accounts-table-body">
                    <!-- Accounts will be loaded via JavaScript -->
                </tbody>
            </table>
            </div>

            <div id="no-accounts" class="no-requests" style="display: none;">
                <p>No accounts found.</p>
            </div>
            <div id="loading" class="no-requests">
                <p>Loading accounts...</p>
            </div>
        </div>

    <!-- Pagination -->
    <div class="pagination" id="accountsPagination">
        <button id="prevPage" class="pagination-btn">← Previous</button>
        <span id="paginationInfo"></span>
        <button id="nextPage" class="pagination-btn">Next →</button>
    </div>

<!-- Add/Edit modal -->
  <div id="accountModal" class="modal" aria-hidden="true" style="display:none">
    <div class="modal-content">
      <h2 id="modalTitle">Add Account</h2>
      <form id="accountForm">
        <div class="form-row">
            <div class="form-group">
                <label for="AccountNumber">Account Number <span class="required">*</span></label>
                <input id="AccountNumber" name="AccountNumber" required pattern="\d+" title="Digits only, leading zeros allowed">
            </div>
            <div class="form-group">
                <label for="AccountName">Account Name <span class="required">*</span></label>
                <input id="AccountName" name="AccountName" required>
            </div>
        </div>
        <div class="form-group">
            <label for="Description">Description</label>
            <input id="Description" name="Description">
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="NormalSide">Normal Side <span class="required">*</span></label>
                <select id="NormalSide" name="NormalSide" required>
                    <option value="Debit">Debit</option>
                    <option value="Credit">Credit</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Statement">Statement</label>
                <select id="Statement" name="Statement">
                    <option value="BS">BS</option>
                    <option value="IS">IS</option>
                    <option value="RE">RE</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="Category">Category</label>
                <input id="Category" name="Category">
            </div>
            <div class="form-group">
                <label for="Subcategory">Subcategory</label>
                <input id="Subcategory" name="Subcategory">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="InitialBalance">Initial Balance</label>
                <input id="InitialBalance" name="InitialBalance" value="0.00">
            </div>
            <div class="form-group">
                <label for="Balance">Balance</label>
                <input id="Balance" name="Balance" value="0.00">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="Debit">Debit</label>
                <input id="Debit" name="Debit" value="0.00">
            </div>
            <div class="form-group">
                <label for="Credit">Credit</label>
                <input id="Credit" name="Credit" value="0.00">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="Order">Order</label>
                <input id="Order" name="Order">
            </div>
            <div class="form-group">
                <label for="Comment">Comment</label>
                <input id="Comment" name="Comment">
            </div>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" id="cancelModal" class="btn btn-secondary">Cancel</button>
        </div>
      </form>
    </div>
  </div>

    <script>
        document.querySelector('.nav-toggle').addEventListener('click', function() {
            document.querySelector('.navbar').style.left = '0';
        });

        document.querySelector('.navbar').addEventListener('mouseleave', function() {
            document.querySelector('.navbar').style.left = '-250px';
        });

        window.user_role = '{{ user_role }}';
    </script>

  <script src="/frontend/ChartOfAccounts.js"></script>
</body>
</html>